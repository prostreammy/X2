<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>119 Ria C HD - Working 2025</title>
    <style>
        body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; min-height:100vh; font-family:Arial; }
        .container { width:100%; max-width:1100px; background:#111; border-radius:12px; overflow:hidden; box-shadow:0 0 30px rgba(0,150,255,0.3); }
        .header { padding:15px 20px; background:linear-gradient(90deg,#0066ff,#00aaff); display:flex; align-items:center; gap:15px; }
        .header img { height:50px; border-radius:8px; }
        .header h1 { margin:0; color:white; font-size:1.6em; }
        video { width:100%; background:black; }
        .status { padding:10px; text-align:center; background:#222; color:#0f0; font-family:monospace; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://get.perfecttv.net/logo/ria.png" alt="RIA">
        <h1>119 Ria C HD</h1>
    </div>
    <video id="video" controls autoplay playsinline></video>
    <div class="status" id="status">Initializing player...</div>
</div>

<!-- Shaka Player v4.10+ (latest stable) -->
<script src="https://cdn.jsdelivr.net/npm/shaka-player@4.10.5/dist/shaka-player.compiled.js"></script>

<script>
    const video = document.getElementById('video');
    const status = document.getElementById('status');

    const REAL_MANIFEST = 'https://load.perfecttv.net/rwt.mpd?username=vip_r92bmh1k&password=yb3IpqrB&channel=riahd';

    // YOUR PROXY ENDPOINT (must be on same domain or CORS-enabled)
    const PROXY_URL = '/api/proxy';  // ← Change only this if needed

    async function init() {
        shaka.polyfill.installAll();

        if (!shaka.Player.isBrowserSupported()) {
            status.textContent = "Browser not supported";
            return;
        }

        // Modern way (no deprecation warning)
        const player = new shaka.Player();
        await player.attach(video);

        // === PROXY ALL REQUESTS (manifest + segments) ===
        player.getNetworkingEngine().registerRequestFilter((type, request) => {
            if (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
                type === shaka.net.NetworkingEngine.RequestType.SEGMENT) {

                const originalUrl = request.uris[0];
                request.uris[0] = `${PROXY_URL}?url=${encodeURIComponent(originalUrl)}`;
            }
        });

        // === REAL CLEARKY (base64 encoded - this is correct) ===
        player.configure({
            drm: {
                clearKeys: {
                    '1SSsJAUQSVSUiC9Cw3CHyw==': '1Z9qe+0AvVOIV1q1s+5qoA=='   // kid:key in base64
                }
            }
        });

        // Error handling
        player.addEventListener('error', (e) => {
            console.error('Shaka Error:', e.detail);
            status.textContent = `Error ${e.detail.code}: ${e.detail.message || 'Check console'}`;
        });

        try {
            status.textContent = "Loading stream...";
            await player.load(`${PROXY_URL}?url=${encodeURIComponent(REAL_MANIFEST)}`);
            status.textContent = "✓ Playing 119 Ria C HD";
            status.style.background = '#0a0';
        } catch (err) {
            status.textContent = "Failed to load stream";
            console.error(err);
        }
    }

    init();
</script>
</body>
</html>
